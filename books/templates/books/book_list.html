{% extends "base.html" %} {% load static %} {% block content %}
<div
    x-data="{ showSearchModal: false }"
    @keydown.escape.window="showSearchModal = false"
    class="flex flex-col h-full bg-black relative"
>
    <header
        class="px-10 py-6 pt-12 flex justify-between items-end bg-black sticky top-0 z-10 border-b border-white/5"
    >
        <div>
            <h2
                class="text-gray-500 text-[10px] font-sans font-bold tracking-[0.3em] uppercase mb-1"
            >
                Library
            </h2>
            <h1
                class="text-2xl font-serif text-white font-medium tracking-tight"
            >
                My Books
            </h1>
        </div>
        <button
            @click="showSearchModal = true"
            class="p-2 -mr-2 rounded-full text-white hover:bg-white/10 transition-colors"
        >
            {% include "icons/search.html" %}
        </button>
    </header>

    <div
        class="flex-1 overflow-y-auto no-scrollbar px-10 py-8 pb-32"
        hx-get="{% url 'books:book-list-htmx' %}"
        hx-trigger="load"
        hx-swap="innerHTML"
    >
        <!-- Book grid will be loaded here by HTMX -->
        <div class="grid grid-cols-5 gap-x-10 gap-y-12">
            {# Placeholder content before HTMX loads #}
        </div>
    </div>

    <!-- Search Modal -->
    <div
        x-show="showSearchModal"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-50 flex items-start justify-center pt-20 bg-black bg-opacity-80 backdrop-blur-sm"
    >
        <div
            @click.away="showSearchModal = false"
            class="w-full max-w-2xl bg-[#111] border border-white/10 rounded-2xl shadow-2xl p-4"
        >
            <input
                type="text"
                name="q"
                class="w-full px-6 py-4 bg-transparent border-b border-white/10 focus:outline-none focus:ring-0 focus:border-white/50 text-white text-lg font-serif"
                placeholder="Search for books on Flibusta..."
                hx-get="{% url 'books:search' %}"
                hx-trigger="keyup changed delay:500ms"
                hx-target="#search-results"
                hx-swap="innerHTML"
                hx-indicator="#search-spinner"
            />

            <div id="search-spinner" class="htmx-indicator text-center p-4">
                <span class="text-gray-400">Searching...</span>
            </div>
            <div
                id="search-results"
                class="mt-4 max-h-[60vh] overflow-y-auto no-scrollbar"
            >
                <!-- Search results will be loaded here -->
            </div>
        </div>
    </div>

    <div
        class="fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-md border-t border-white/10 z-50"
    >
        <div class="flex justify-around items-center py-4 pb-6">
            {% include "icons/library.html" %} {% include "icons/compass.html"
            %} {% include "icons/user.html" %}
        </div>
    </div>
</div>
{% endblock %}
